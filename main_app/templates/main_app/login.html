{% extends "base.html" %}
{% load form_tags %}

{% block title %}ورود{% endblock %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center">
  <div class="card w-full max-w-md">
    <h1 class="card-title">ورود به سامانه</h1>

    <form method="POST" class="space-y-4">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <div class="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-700">
        {% for err in form.non_field_errors %}
          <div>{{ err }}</div>
        {% endfor %}
      </div>
      {% endif %}

      <div>
        <label for="{{ form.username.id_for_label }}" class="form-label">نام کاربری</label>
        {{ form.username|add_class:'form-input' }}
        {% if form.username.errors %}
          <p class="error-text">{{ form.username.errors.0 }}</p>
        {% endif %}
      </div>

      <div>
        <label for="{{ form.password.id_for_label }}" class="form-label">رمز عبور</label>
        <div class="relative">
          {{ form.password|add_class:'form-input pr-12' }}
          <button type="button" id="togglePassword" class="absolute inset-y-0 left-2 my-auto text-sm text-gray-500 hover:text-gray-700">
            نمایش
          </button>
        </div>
        {% if form.password.errors %}
          <p class="error-text">{{ form.password.errors.0 }}</p>
        {% endif %}
      </div>

      <button type="submit" class="btn-primary">ورود</button>
    </form>

    <p class="mt-4 text-center muted">
      حساب کاربری ندارید؟
      <a href="{% url 'register' %}" class="link">ثبت‌نام</a>
    </p>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('togglePassword');
    if (!toggle) return;
    const pwdInput = document.getElementById('{{ form.password.id_for_label }}') || document.querySelector('input[type="password"]');
    toggle.addEventListener('click', function() {
      if (!pwdInput) return;
      const isPwd = pwdInput.getAttribute('type') === 'password';
      pwdInput.setAttribute('type', isPwd ? 'text' : 'password');
      toggle.textContent = isPwd ? 'مخفی' : 'نمایش';
    });
  });
</script>
{% endblock %}
